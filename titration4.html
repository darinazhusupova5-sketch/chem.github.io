<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>–í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ —Ç–∏—Ç—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –ø–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #e3f2fd;
      overflow: hidden;
      touch-action: none;
    }
    .lab {
      position: relative;
      width: 100vw;
      height: 100vh;
      background: #ffffff;
    }
    h1 {
      text-align: center;
      padding: 15px;
      background: #005792;
      color: white;
      font-size: 1.4rem;
    }
    #pipette {
      position: absolute;
      top: 60px;
      left: 120px;
      width: 32px;
      height: 100px;
      background: #e0e0e0;
      border: 2px solid #555;
      border-radius: 8px;
      cursor: grab;
      z-index: 100;
      user-select: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    #pipette::after {
      content: "";
      position: absolute;
      bottom: -12px;
      left: 50%;
      transform: translateX(-50%);
      width: 6px;
      height: 24px;
      background: #bbb;
      border-radius: 0 0 4px 4px;
    }
    .flask {
      position: absolute;
      bottom: 120px;
      left: 50%;
      transform: translateX(-50%);
      width: 150px;
      height: 170px;
      z-index: 10;
    }
    .flask-body {
      position: absolute;
      bottom: 0;
      width: 150px;
      height: 120px;
      background: #f9f9f9;
      border: 2px solid #333;
      border-radius: 50% 50% 15% 15%;
    }
    .flask-liquid {
      position: absolute;
      bottom: 2px;
      width: 146px;
      height: 75px;
      background: #e0f7fa;
      border-radius: 50% 50% 15% 15%;
      transition: background 0.6s, height 0.2s;
    }
    .flask-neck {
      position: absolute;
      top: 0;
      left: 60px;
      width: 30px;
      height: 50px;
      background: #f9f9f9;
      border: 2px solid #333;
      border-bottom: none;
    }
    #drop {
      position: absolute;
      width: 8px;
      height: 12px;
      background: #bbdefb;
      border-radius: 50%;
      z-index: 50;
      opacity: 0;
      pointer-events: none;
    }
    .panel {
      position: absolute;
      bottom: 20px;
      left: 20px;
      right: 20px;
      background: #e8f5e9;
      padding: 14px;
      border-radius: 10px;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .status-box {
      position: absolute;
      top: 20px;
      right: 20px;
      background: #fff8e1;
      padding: 12px;
      border-radius: 8px;
      min-width: 190px;
      text-align: center;
      font-weight: bold;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .instructions {
      position: absolute;
      top: 90px;
      right: 20px;
      background: #e3f2fd;
      padding: 12px;
      border-radius: 8px;
      font-size: 13px;
      max-width: 220px;
    }
    .btn {
      margin-top: 10px;
      padding: 6px 14px;
      background: #007BFF;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }
    .btn:hover { background: #0056b3; }
    .btn-report {
      background: #4CAF50;
      margin-left: 10px;
    }
    .btn-report:hover { background: #388E3C; }
  </style>
</head>
<body>

<div class="lab">
  <h1>üß™ –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ —Ç–∏—Ç—Ä–æ–≤–∞–Ω–∏–µ</h1>
  
  <div id="pipette"></div>
  <div id="drop"></div>

  <div class="flask">
    <div class="flask-neck"></div>
    <div class="flask-body"></div>
    <div class="flask-liquid" id="flaskLiquid"></div>
  </div>

  <div class="status-box" id="status">–î–æ–±–∞–≤–ª–µ–Ω–æ: 0.0 –º–ª</div>

  <div class="instructions">
    <strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong><br>
    ‚Ä¢ –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –ø–∏–ø–µ—Ç–∫—É –º—ã—à—å—é –∏–ª–∏ –ø–∞–ª—å—Ü–µ–º<br>
    ‚Ä¢ –ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ –∫–æ–ª–±—É<br>
    ‚Ä¢ <strong>–ö–ª–∏–∫–Ω–∏—Ç–µ –∏–ª–∏ –∫–æ—Å–Ω–∏—Ç–µ—Å—å</strong> ‚Äî –¥–æ–±–∞–≤–∏—Ç—å 0.1 –º–ª
  </div>

  <div class="panel">
    <p><strong>–ó–∞–¥–∞—á–∞:</strong> –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é 10 –º–ª HCl, —Ç–∏—Ç—Ä—É—è 0.100 –ú NaOH.<br>
    –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä ‚Äî —Ñ–µ–Ω–æ–ª—Ñ—Ç–∞–ª–µ–∏–Ω. –¢–æ—á–∫–∞ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç–∏ ‚âà 8.7 –º–ª.</p>
    <button class="btn" onclick="reset()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
    <a href="https://docs.google.com/forms/d/e/1FAIpQLSfX9sZvVZqRjv4Y3mW7Q6uVxHcJfT2yL8nKpQjR7bN3W4Z5aA/viewform?usp=sf_link" 
       target="_blank" class="btn btn-report">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á—ë—Ç</a>
  </div>
</div>

<!-- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∑–≤—É–∫ –∫–∞–ø–ª–∏ (base64, –∫–æ—Ä–æ—Ç–∫–∏–π "plink") -->
<audio id="dropSound" preload="auto">
  <source src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAA" type="audio/wav">
</audio>

<script>
  // --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ---
  const endpointVolume = 8.7; // –º–ª –¥–æ —Ç–æ—á–∫–∏ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç–∏
  const flaskVolume = 10.0;   // –º–ª –∫–∏—Å–ª–æ—Ç—ã
  const naohConc = 0.100;     // –ú

  // --- –≠–ª–µ–º–µ–Ω—Ç—ã DOM ---
  const pipette = document.getElementById('pipette');
  const dropEl = document.getElementById('drop');
  const flask = document.querySelector('.flask');
  const flaskLiquid = document.getElementById('flaskLiquid');
  const statusEl = document.getElementById('status');
  const audio = document.getElementById('dropSound');

  // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ ---
  let addedNaOH = 0;
  let isDragging = false;
  let startX, startY, pipetteX, pipetteY;

  // --- –û–±—Ä–∞–±–æ—Ç–∫–∞ –º—ã—à–∏ –∏ —Ç–∞—á–∞ ---
  function startDrag(clientX, clientY) {
    isDragging = true;
    pipette.style.cursor = 'grabbing';
    const rect = pipette.getBoundingClientRect();
    startX = clientX;
    startY = clientY;
    pipetteX = rect.left;
    pipetteY = rect.top;
  }

  function movePipette(clientX, clientY) {
    if (!isDragging) return;
    const dx = clientX - startX;
    const dy = clientY - startY;
    pipette.style.left = (pipetteX + dx) + 'px';
    pipette.style.top = (pipetteY + dy) + 'px';
  }

  function endDrag() {
    if (isDragging) {
      isDragging = false;
      pipette.style.cursor = 'grab';
    }
  }

  // –°–æ–±—ã—Ç–∏—è –º—ã—à–∏
  pipette.addEventListener('mousedown', (e) => {
    startDrag(e.clientX, e.clientY);
    e.preventDefault();
  });
  document.addEventListener('mousemove', (e) => movePipette(e.clientX, e.clientY));
  document.addEventListener('mouseup', endDrag);

  // –°–æ–±—ã—Ç–∏—è —Ç–∞—á–∞ (–¥–ª—è –ø–ª–∞–Ω—à–µ—Ç–æ–≤/—Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤)
  pipette.addEventListener('touchstart', (e) => {
    const touch = e.touches[0];
    startDrag(touch.clientX, touch.clientY);
    e.preventDefault();
  });
  document.addEventListener('touchmove', (e) => {
    if (e.touches.length > 0) {
      const touch = e.touches[0];
      movePipette(touch.clientX, touch.clientY);
      e.preventDefault();
    }
  });
  document.addEventListener('touchend', endDrag);

  // --- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞–ø–ª–∏ ---
  function addDrop() {
    if (addedNaOH >= 10.0) return;

    // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫
    audio.currentTime = 0;
    audio.play().catch(e => console.log("–ó–≤—É–∫ –æ—Ç–∫–ª—é—á–µ–Ω –≤ –±—Ä–∞—É–∑–µ—Ä–µ"));

    // –ê–Ω–∏–º–∞—Ü–∏—è –∫–∞–ø–ª–∏
    const pipetteRect = pipette.getBoundingClientRect();
    const flaskRect = flask.getBoundingClientRect();
    const dropX = pipetteRect.left + pipetteRect.width / 2 - 4;
    const dropY = pipetteRect.bottom;

    dropEl.style.left = dropX + 'px';
    dropEl.style.top = dropY + 'px';
    dropEl.style.opacity = '1';
    dropEl.style.transition = 'none';

    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–∞–¥–µ–Ω–∏—è
    setTimeout(() => {
      dropEl.style.transition = 'top 0.4s cubic-bezier(0.3, 1, 0.6, 1)';
      dropEl.style.top = (flaskRect.top + 30) + 'px';
      dropEl.style.opacity = '0';
    }, 50);

    // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—ä—ë–º
    addedNaOH += 0.1;
    updateView();
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Å –∫–æ–ª–±–æ–π
  function isPipetteOverFlask() {
    const p = pipette.getBoundingClientRect();
    const f = flask.getBoundingClientRect();
    return p.right > f.left && p.left < f.right && p.bottom > f.top && p.top < f.bottom;
  }

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞/—Ç–∞—á–∞
  function handleClick() {
    if (isDragging) return;
    if (isPipetteOverFlask()) {
      addDrop();
    }
  }

  document.addEventListener('click', handleClick);
  document.addEventListener('touchend', (e) => {
    if (!isDragging) handleClick();
  });

  // --- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ---
  function updateView() {
    if (addedNaOH >= endpointVolume) {
      flaskLiquid.style.background = '#f8bbd0';
      const c_hcl = (naohConc * addedNaOH / flaskVolume).toFixed(3);
      statusEl.innerHTML = `‚úÖ –¢–æ—á–∫–∞ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!<br>NaOH: ${addedNaOH.toFixed(1)} –º–ª<br>C<sub>HCl</sub> = ${c_hcl} –ú`;
    } else {
      flaskLiquid.style.background = '#e0f7fa';
      statusEl.textContent = `–î–æ–±–∞–≤–ª–µ–Ω–æ: ${addedNaOH.toFixed(1)} –º–ª`;
    }
  }

  // --- –°–±—Ä–æ—Å ---
  function reset() {
    addedNaOH = 0;
    pipette.style.left = '120px';
    pipette.style.top = '60px';
    dropEl.style.opacity = '0';
    updateView();
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  updateView();
</script>

</body>
</html>